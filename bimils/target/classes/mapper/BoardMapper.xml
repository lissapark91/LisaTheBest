<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="Board">
  	
  	<select id="selectBoardCnt" resultType="int" parameterType="map">
  		
  		SELECT  
		count(*) as count
		FROM
		bm_board
		WHERE
		bo_del_yn = 'N'
		
  		/* paramMap에 의한 제약 조건 (검색) */
  	
  	</select>
  	
  	<select id="selectBoardList" resultType="Board" parameterType="map">
  		/* paging */
  	<include refid="CommonMapper.pageHeader"></include>
  	SELECT
  		  a.bo_seq_no
		, a.bo_title
		, a.bo_type
		, a.bo_writer
		, a.bo_writer_open
		, b.mem_name as bo_writer_name
		, a.bo_content
		, a.bo_hit_cnt
		, a.bo_price
		, a.reg_user
		, a.reg_date
		, a.bo_up
		, a.bo_down
	FROM
		bm_board a , bm_member b
	WHERE
		a.bo_del_yn = 'N'
		
  	ORDER BY reg_date DESC
  	
  	<include refid="CommonMapper.pageFooter"></include>
  	</select>
  	
  	<select id="selectBoard" resultType="Board" parameterType="int">
  	
  	SELECT
  		  a.bo_seq_no
		, a.bo_title
		, a.bo_type
		, a.bo_writer
		, a.bo_writer_open
		, (SELECT b.mem_name 
		     FROM bm_member b 
		     WHERE a.bo_writer = b.mem_id) as bo_writer_name
		, a.bo_content
		, a.bo_hit_cnt
		, a.bo_price
		, a.reg_user
		, a.reg_date
		, a.bo_up
		, a.bo_down
	FROM
		bm_board a
	WHERE
		a.bo_seq_no = #{bo_seq_no}
  	  	
  	</select>
  	
  	<select id="selectHotBoardList" resultType="Board">
  	<include refid="CommonMapper.pageHeader"></include>
  	
  	SELECT
  		  a.bo_seq_no
		, a.bo_title
		, a.bo_type
		, (a.bo_up + a.bo_down) as bo_up_cnt
	FROM
		bm_board a
	ORDER BY bo_up_cnt DESC
	
			    ) TB 
		) WHERE RNUM BETWEEN 1 AND 10
		
  	</select>
  	
  	<insert id="insertBoard" parameterType="Board">

  	<selectKey keyProperty="bo_seq_no" resultType="int" order="BEFORE">
  		SELECT SEQ_BO_SEQ_NO.NEXTVAL FROM DUAL
  	</selectKey>
  	
  	INSERT INTO BM_BOARD (
	    bo_seq_no,
	    bo_title,
	    bo_type,
	    bo_writer,
	    bo_writer_open,
	    bo_content,
	    bo_hit_cnt,
	    bo_price,
	    reg_user,
	    reg_date,
	    upd_user,
	    upd_date,
	    bo_del_yn,
	    bo_up,
	    bo_down
	) VALUES (
	      #{bo_seq_no}
		, #{bo_title}
		, #{bo_type}
		, #{bo_writer}
		, NVL(#{bo_writer_open}, 'N')
		, #{bo_content}
		, 0
		, 50
		, #{reg_user}
		, SYSDATE
		, #{upd_user}
		, SYSDATE
		, 'N'
		, 0
		, 0
	);
  	
  	
  	</insert>
  	
  	<update id="updateBoardContent" parameterType="Board">
  		
  	UPDATE bm_board
    SET
		  bo_title = #{bo_title}
		, bo_type = #{bo_type}
		, bo_writer_open = #{bo_writer_open}
		, bo_content = #{bo_content}
		, upd_user = #{upd_user}
		, upd_date = SYSDATE
	WHERE
        bo_seq_no = #{bo_seq_no}
  	
  	</update>
  	
  	<update id="updateBoardHitCnt" parameterType="int">
  	
  	UPDATE BM_BOARD SET 
		bo_hit_cnt = bo_hit_cnt + 1
		WHERE bo_seq_no = #{bo_seq_no} 
  
    </update>
    
    <select id="selectUpdownSave" parameterType="map" resultType="int">
    
    SELECT count(save_id) as save_cnt
    FROM bm_updown_save
    WHERE save_id = #{save_id}
    AND bo_seq_no = #{bo_seq_no}
    
    </select>
    
    <update id="updateUpdownSave" parameterType="map">
    
    UPDATE bm_updown_save SET
    	save_id = #{save_id}
    WHERE bo_seq_no = #{bo_seq_no}
    
    </update>
    
    <update id="updateBoardUp" parameterType="int">
  	
  	UPDATE BM_BOARD SET 
		bo_up = bo_up + 1 ,
		bo_price = bo_price + floor((bo_up + bo_down) / 10)
		WHERE bo_seq_no = #{bo_seq_no} 
  
    </update>
    
    <update id="updateBoardDown" parameterType="int">
  	
  	UPDATE BM_BOARD SET 
		bo_down = bo_down + 1 ,
		bo_price = bo_price + floor((bo_up + bo_down) / 10)
		WHERE bo_seq_no = #{bo_seq_no} 
  
    </update>
  	
  	
  	<update id="deleteBoard" parameterType="map">
  		
  	UPDATE bm_board SET
		bo_del_yn = 'Y',
		upd_user = #{upd_user},
	  	upd_date = SYSDATE
	WHERE bo_seq_no = #{bo_seq_no} 
  	
  	</update>
  
  </mapper>